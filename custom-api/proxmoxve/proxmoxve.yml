- type: custom-api
  css-class: services-custom-api
  cache: 1s
  url: https:${PROXMOXVE_URL}/api2/json/cluster/resources
  headers:
    Authorization: PVEAPIToken=${PROXMOXVE_KEY}
    Accept: application/json
  template: |
    <div class="flex flex-column gap-5">
      <a class="services-title" href="${PROXMOXVE_URL}#" target="_blank">
        <div class="flex gap-20 items-center">
          <img src="${DASHBOARD_ICONS}/svg/proxmox.svg">
          <strong class="size-h3 block">Proxmox</strong>
        </div>
      </a>
      {{ range .JSON.Array "data" }}
        {{ if eq (.String "type") "node" }}
          <div class="flex justify-between text-center gap-15">
            <div class="flex-1">
              <div class="flex items-end size-h5">
                <div>CPU</div>
                <div class="color-highlight margin-left-auto text-very-compact">
                  {{ mul (.Float "cpu") 100 | toInt | formatNumber }} <span class="color-base">%</span>
                </div>
              </div>
              <div data-popover-type="html">
                <div data-popover-html>
                  <div class="flex">
                    <div class="size-h5">LOAD</div>
                    <div class="value-separator"></div>
                    <div class="color-highlight text-very-compact">{{ mul (.Float "cpu") 100 | toInt | formatNumber }} <span class="color-base size-h5">%</span></div>
                  </div>
                  <div class="flex margin-top-3">
                    <div class="size-h5">CORES</div>
                    <div class="value-separator"></div>
                    <div class="color-highlight text-very-compact">{{ .Int "maxcpu" }}</div>
                  </div>
                </div>
                <div class="progress-bar progress-bar-combined">
                    <div class="progress-value{{ if ge (mul (.Float "cpu") 100 | toInt) 85 }} progress-value-notice{{ end }}" style="--percent: {{ mul (.Float "cpu") 100 | toInt | formatNumber }}"></div>
                </div>
              </div>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-end size-h5">
                <div>RAM</div>
                <div class="color-highlight text-very-compact">
                  {{ mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt }} <span class="color-base">%</span>
                </div>
              </div>
              <div data-popover-type="html">
                <div data-popover-html>
                  <div class="flex">
                      <div class="size-h5">RAM</div>
                      <div class="value-separator"></div>
                      <div class="color-highlight text-very-compact">
                          {{ div (.Int "mem" | toFloat) 1073741824 | toInt | formatNumber }}GB <span class="color-base size-h5">/</span> {{ div (.Int "maxmem" | toFloat) 1073741824 | toInt | formatNumber }}GB
                      </div>
                  </div>
                </div>
                <div class="progress-bar progress-bar-combined">
                  <div class="progress-value{{ if ge (mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt) 85 }} progress-value-notice{{ end }}" style="--percent: {{ mul (div (.Int "mem" | toFloat) (.Int "maxmem" | toFloat)) 100 | toInt }}"></div>
                </div>
              </div>
            </div>
            <div class="flex-1">
              <div class="flex justify-between items-end size-h5">
                  <div>DISK</div>
                  <div class="color-highlight text-very-compact">
                    {{ mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt }} <span class="color-base">%</span>
                  </div>
              </div>
              <div data-popover-type="html">
                <div data-popover-html>
                  <div class="flex">
                      <div class="size-h5">DISK</div>
                      <div class="value-separator"></div>
                      <div class="color-highlight text-very-compact">
                          {{ div (.Int "disk" | toFloat) 1073741824 | toInt | formatNumber }}GB <span class="color-base size-h5">/</span> {{ div (.Int "maxdisk" | toFloat) 1073741824 | toInt | formatNumber }}GB
                      </div>
                  </div>
                </div>
                <div class="progress-bar progress-bar-combined">
                  <div class="progress-value{{ if ge (mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt) 85 }} progress-value-notice{{ end }}" style="--percent: {{ mul (div (.Int "disk" | toFloat) (.Int "maxdisk" | toFloat)) 100 | toInt }}"></div>
                </div>
              </div>
            </div>
          </div>
        {{ end }}
      {{ end }}
    </div>